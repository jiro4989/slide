# grepでの検索結果の続きを表示するコマンドを作った

この記事は2022RustアドベントカレンダーのN日目の記事です。

Rustの勉強がてら、grepの検索結果の続きを表示するコマンドを作ってみました。

## 経緯

表題の通り、grepの検索結果の続きが表示したくなったからです。

例えば、ログファイルの調査をする場合です。
以下のように、何らかのデータを処理するときに、beginで始まり、いくつかログが継続して、endで処理が終了するようなログファイルがあるとします。

```log
2022/01/01T01:00:00 a12b1cfefa2a37a89fe73 begin
2022/01/01T01:00:01 a12b1cfefa2a37a89fe73 foobar1
2022/01/01T01:00:01 a12b1cfefa2a37a89fe73 foobar2
2022/01/01T01:00:02 a12b1cfefa2a37a89fe73 foobar3
2022/01/01T01:00:03 a12b1cfefa2a37a89fe73 end
```

このログファイルに対して end という文字列で検索をします。
すると標準出力は以下のようになります。

```log
$ grep end a.log
2022/01/01T01:00:03 a12b1cfefa2a37a89fe73 end
```

この検索結果に対して、1行前の行を表示したくなりました。

今回のケースで言うと、別にgrepだけでも目的を達成できます。
以下のようにします。

```bash
$ grep -B 1 end a.log
2022/01/01T01:00:02 a12b1cfefa2a37a89fe73 foobar3
2022/01/01T01:00:03 a12b1cfefa2a37a89fe73 end

$ grep -B 1 end a.log | grep foobar3
2022/01/01T01:00:02 a12b1cfefa2a37a89fe73 foobar3
```

この程度のケースであれば、わざわざ専用コマンドを作る必要はありません。
しかしながら、コマンドをパイプで繋いで複数の条件で検索を繰り返した結果に対して、その前後の行を表示したくなったときに、
grep にオプションを付け足すのはめんどくさいです。
検索結果に対してコマンドをあとづけするだけで、その前後の行を表示できるようなソリューションが欲しくなります。

探したけれど、この目的を満たしたコマンドはなさそうだったので、自作しました。
